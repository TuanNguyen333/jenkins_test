pipeline {
    agent { label 'Tuan' }

    stages {
        stage("Hello World") {
            steps {
                echo "Hello World"
            }
        }

        stage('Run Batch Script 1') {
            steps {
                script {
                    try {
                        echo 'Running Batch Script 1...'
                        sh 'exit 1'  // Giả lập lỗi
                    } catch (Exception e) {
                        currentBuild.result = 'FAILURE'  // Đặt kết quả build là FAILURE nếu có lỗi
                        echo "Error in Batch Script 1, but continuing pipeline"
                    }
                }
            }
        }

        stage('Run Batch Script 2') {
            when {
                expression { return currentBuild.result == 'FAILURE' }  // Chỉ chạy khi Stage 1 thất bại
            }
            steps {
                echo 'Running Batch Script 2 due to failure in previous stage...'
                bat 'Script/Batch_script_2.bat'
            }
        }

        stage('Run Batch Script 3') {
            steps {
                echo 'Running Batch Script 3 (always runs, regardless of build status)...'
                bat 'Script/Batch_script_3.bat'
                echo 'Archiving log file generated by Batch Script 3...'
                archiveArtifacts artifacts: 'Script/logfile.log', fingerprint: true
            }
        }
    }

    post {
        always {
            echo 'Pipeline finished.'
        }
    }
}



    // post {
    //     success {
    //         echo 'Build Successful. Sending success email...'
    //         mail to: 'nmtuan0311@gmail.com',
    //              subject: "Jenkins Build Successful: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
    //              body: "Build was successful!"
    //     }
    //     failure {
    //         echo 'Build Failed. Sending failure email...'
    //         mail to: 'nmtuan0311@gmail.com',
    //              subject: "Jenkins Build Failed: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
    //              body: "Build has failed"
    //     }
        
    // }

